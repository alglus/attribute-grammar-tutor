<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="bootstrap/bootstrap.5.1.3.min.css">
    <link rel="stylesheet" href="jointJS/joint.3.5.4.min.css"/>
    <link rel="stylesheet" href="codemirror/codemirror.5.65.2.css"/>
    <link rel="stylesheet" href="css/main.css">
    <title>Attribute Systems Tutor</title>
</head>
<body>
<div id="mainContainer" class="container">
    <!-- Header -->
    <header>
        <h1 class="float-start">Attribute Systems Tutor</h1>
        <button id="aboutBtn" type="button" class="headerButtons btn btn-outline-secondary btn-sm float-end" title="About" data-bs-toggle="modal" data-bs-target="#about">
            <svg class="bi bi-info-circle" width="16" height="16" role="img" aria-label="About">
                <use xlink:href="#info-circle"/>
            </svg>
        </button>
        <button id="helpBtn" type="button" class="headerButtons btn btn-outline-secondary btn-sm float-end" title="Help" data-bs-toggle="modal" data-bs-target="#help">
            <svg class="bi bi-question-circle" width="16" height="16" role="img" aria-label="Help">
                <use xlink:href="#question-circle"/>
            </svg>
        </button>
    </header>
    <main>

        <!-- Grammar input -->
        <div class="input-group pt-4 mb-2">
            <span class="input-group-text">Attribute <br>Grammar</span>
            <div class="form-control" id="grammarInputWrapper"></div>
        </div>

        <!-- Grammar buttons -->
        <button type="button" id="applyGrammarButton" class="btn btn-primary me-2">Apply</button>
        <button type="button" id="editGrammarButton" class="btn btn-secondary" disabled>Edit</button>

        <!-- noscript warning -->
        <noscript>
            <div class="alert alert-danger" role="alert">This page only works with JavaScript enabled.</div>
        </noscript>

        <!-- Grammar errors -->
        <ul class="list-group pt-3" id="grammarErrorMessages"></ul>

        <!-- Local dependencies exercise -->
        <div id="dependenciesExercise" class="accordion pt-4">
            <div class="accordion-item">
                <h2 id="dependencies-heading" class="accordion-header">
                    <button id="dependenciesCollapseBtn" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#dependencies-collapse" aria-expanded="true" aria-controls="dependencies-collapse">
                        <span id="dependenciesCollapseBtnTitle" class="d-flex">Local dependency graphs</span>
                        <span id="dependenciesCollapseBtnInfo" class="d-flex flex-grow-1 pe-3 justify-content-end">
                            <svg data-bs-toggle="tooltip" data-bs-placement="bottom" class="bi bi-info-circle-fill" width="18" height="18" role="img" aria-label="Info"
                                 data-bs-original-title="For every production rule, draw the syntax tree (blue nodes) and then add the corresponding attributes and their dependencies (green nodes). Start off by double clicking on the graph canvas to create a syntax tree node. For more info, click on help at the top of the page.">
                                <use xlink:href="#info-circle-fill"/>
                            </svg>
                        </span>
                    </button>
                </h2>
                <div id="dependencies-collapse" class="accordion-collapse collapse show" aria-labelledby="dependencies-heading">
                    <div class="accordion-body px-0">
                        <div class="container px-0">
                            <div id="dependencyGraphsRow" class="row px-0 gy-4">

                                <!-- Local dependency graph card -->
                                <div class="col-auto dependenciesGraphCard" data-index="0">
                                    <div class="card">
                                        <div class="card-header dependenciesGraphCardHeader d-flex align-items-center" data-index="0">
                                            <h6 class="dependenciesGraphCardTitle" data-index="0">X -> X</h6>
                                            <button class="showGraphErrorsBtn btn btn-outline-danger btn-sm" data-index="0">
                                                <svg class="bi bi-exclamation-triangle-fill" width="16" height="16" role="img">
                                                    <use xlink:href="#exclamation-triangle-fill"/>
                                                </svg>
                                            </button>
                                            <svg class="dependencyGraphCorrectIcon bi bi-check-circle-fill" data-index="0" width="20" height="20" role="img">
                                                <use xlink:href="#check-circle-fill"/>
                                            </svg>
                                        </div>

                                        <!-- new JointJS graph paper is inserted here -->

                                        <!-- Local dependency graph errors -->
                                        <div class="graphErrors" data-index="0">
                                            <ul class="graphErrorMessages" data-index="0"></ul>
                                        </div>

                                        <!-- Local dependency graph buttons -->
                                        <div class="container text-center p-2 border-top">
                                            <div class="row justify-content-center">
                                                <button type="button" data-index="0" class="col-auto btn btn-outline-secondary btn-sm me-2 dependenciesCheckBtn">Check</button>
                                                <button type="button" data-index="0" class="col-auto btn btn-outline-secondary btn-sm me-2 dependenciesClearBtn">Clear</button>
                                                <button type="button" data-index="0" class="col-auto btn btn-outline-secondary btn-sm me-2 dependenciesDrawBtn">Draw tree</button>
                                                <button type="button" data-index="0" class="col-auto btn btn-outline-secondary btn-sm me-2 dependenciesSolutionBtn">Show solution</button>
                                                <button type="button" data-index="0" class="col-auto btn btn-outline-secondary dependenciesRecenterBtn">
                                                    <svg class="bi" width="16" height="16" role="img">
                                                        <use xlink:href="#arrows-to-center"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Local dependency graph ALL buttons -->
                    <div class="container text-center p-4">
                        <div class="gy-3 row justify-content-center">
                            <button id="dependenciesCheckAllBtn" type="button" class="col-auto btn btn-outline-primary me-3">Check all</button>
                            <button id="dependenciesClearAllBtn" type="button" class="col-auto btn btn-outline-primary me-3">Clear all</button>
                            <button id="dependenciesDrawAllBtn" type="button" class="col-auto btn btn-outline-primary me-3">Draw all trees</button>
                            <button id="dependenciesAllSolutionsBtn" type="button" class="col-auto btn btn-outline-primary me-3">Show all solutions</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Strong acyclicity exercise -->
        <div id="acyclicityExercise" class="accordion pt-4">
            <div class="accordion-item">

                <!-- Strong acyclicity heading -->
                <h2 id="acyclicity-heading" class="accordion-header">
                    <button id="acyclicityCollapseBtn" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acyclicity-collapse" aria-expanded="true" aria-controls="acyclicity-collapse">
                        <span id="acyclicityCollapseBtnTitle" class="d-flex">Strong acyclicity</span>
                        <span id="acyclicityCollapseBtnInfo" class="d-flex flex-grow-1 pe-3 justify-content-end">
                            <svg data-bs-toggle="tooltip" data-bs-placement="bottom" class="bi bi-info-circle-fill" width="18" height="18" role="img" aria-label="Info"
                                 data-bs-original-title="For every production rule, draw the redecorated relations with a green edge and the root projections with a yellow one. Decide, whether a cycle was formed in each graph and whether the iteration is stable. Also write down the transitive relation for each non-terminal, using the standard format. For more info, click on help at the top of the page.">
                                <use xlink:href="#info-circle-fill"/>
                            </svg>
                        </span>
                    </button>
                </h2>
                <div id="acyclicity-collapse" class="accordion-collapse collapse" aria-labelledby="acyclicity-heading">
                    <div class="accordion-body">

                        <!-- Warning: complete local dependency exercise first -->
                        <div id="acyclicityExerciseNotEnabledWarning" class="alert alert-warning " role="alert">
                            <div class="p-5 d-flex align-items-center justify-content-center">
                                <svg class="bi bi-info-circle-fill flex-shrink-0 me-4" width="24" height="24" role="img">
                                    <use xlink:href="#info-circle-fill"/>
                                </svg>
                                <div>
                                    This exercise can only be solved, after all local dependency graphs have been drawn correctly.<br><br>
                                    Please finish drawing the local dependency graphs and then click on "Check" for every graph, or click on "Check all" to correct them at once.
                                </div>
                            </div>
                        </div>
                        <div id="shortcutEnd"></div>

                        <!-- Nonterminal container -->
                        <div class="acyclicityNonterminalContainer" data-nonterminal="-1">

                            <!-- Iteration headings -->
                            <div class="acyclicityIterationHeaderContainer">
                                <div class="leftGradient gradient"></div>
                                <div class="rightGradient gradient"></div>
                                <div class="acyclicityIterationHeader scrollSync" data-nonterminal="-1">
                                    <ul class="acyclicityIterationHeaderList" data-nonterminal="-1">
                                        <!-- Iteration title is inserted here -->
                                    </ul>
                                </div>
                            </div>

                            <div class="acyclicityContent d-flex">

                                <!-- Nonterminal title bar -->
                                <div class="acyclicityNonterminalTitle" data-nonterminal="-1">X</div>

                                <div class="acyclicityProductionRules flex-grow-1">

                                    <!-- Production rule row -->
                                    <div class="acyclicityProductionRule d-flex" data-nonterminal="-1" data-production="-1">

                                        <!-- Production rule title -->
                                        <div class="acyclicityProductionRuleText" data-nonterminal="-1" data-production="-1">X -> X</div>

                                        <!-- Graphs row -->
                                        <div class="acyclicityGraphsRow scrollSync d-flex" data-nonterminal="-1" data-production="-1">

                                            <!--Graph card -->
                                            <div class="acyclicityGraphCardContainer" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                <div class="acyclicityGraphCard card" data-nonterminal="-1" data-production="-1" data-iteration="-1">

                                                    <!-- Graph -->
                                                    <div class="acyclicityGraph" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                        <!-- new JointJS graph paper is inserted here -->
                                                    </div>

                                                    <!-- Redecorated / projected link choice -->
                                                    <div class="acyclicityLinkTypes">
                                                        <div class="acyclicityLinkTypesButton linkTypeRedecorated" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                            <input type="radio" id="linkTypeRedecorated_-1_-1_-1" name="linkType_-1_-1_-1" value="redecorated" autocomplete="off" checked>
                                                            <label class="redecorated" for="linkTypeRedecorated_-1_-1_-1" title="Redecorated relations"></label>
                                                        </div>
                                                        <div class="acyclicityLinkTypesButton linkTypeProjected" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                            <input type="radio" id="linkTypeProjected_-1_-1_-1" name="linkType_-1_-1_-1" value="projected" autocomplete="off">
                                                            <label class="projected" for="linkTypeProjected_-1_-1_-1" title="Root projection"></label>
                                                        </div>
                                                    </div>

                                                    <!-- Cycle found radio buttons -->
                                                    <div class="acyclicityCycleFound text-center p-2 border-top d-flex" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                        <p>Cycle found?</p>
                                                        <div class="cycleFoundYes form-check form-check-inline mb-0" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                            <input class="form-check-input" type="radio" name="cycleFound_-1_-1_-1" id="cycleFoundYes_-1_-1_-1" value="yes" autocomplete="off">
                                                            <label class="form-check-label" for="cycleFoundYes_-1_-1_-1">yes</label>
                                                        </div>
                                                        <div class="cycleFoundNo form-check form-check-inline mb-0" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                            <input class="form-check-input" type="radio" name="cycleFound_-1_-1_-1" id="cycleFoundNo_-1_-1_-1" value="no" autocomplete="off">
                                                            <label class="form-check-label" for="cycleFoundNo_-1_-1_-1">no</label>
                                                        </div>
                                                        <svg class="acyclicityWarningIcon bi bi-exclamation-triangle-fill" width="18" height="18" role="img" data-nonterminal="-1" data-production="-1" data-iteration="-1">
                                                            <use xlink:href="#exclamation-triangle-fill"/>
                                                        </svg>
                                                        <svg class="acyclicityGraphCorrectIcon bi bi-check-circle-fill" data-nonterminal="-1" data-production="-1" data-iteration="-1" width="18" height="18" role="img">
                                                            <use xlink:href="#check-circle-fill"/>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Transitive relations -->
                                    <div class="acyclicityTransitiveRelationsContainer d-flex" data-nonterminal="-1">
                                        <div class="acyclicityTransitiveRelationsText">R</div>
                                        <div class="acyclicityTransitiveRelations flex-grow-1 scrollSync">
                                            <ul class="acyclicityTransitiveRelationsList" data-nonterminal="-1">
                                                <li class="acyclicityTransitiveRelationsItem" data-nonterminal="-1" data-iteration="-1">
                                                    <div class="d-flex">
                                                        <label for="transitiveRelation_-1_-1"><span>R</span> ( <i>X</i> ) =</label>
                                                        <input id="transitiveRelation_-1_-1" type="text" placeholder="(a,b), (c,d)" autocomplete="off">
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- Strong acyclicity footer -->
                        <div id="acyclicityFooterContainer">
                            <div class="leftGradient gradient"></div>
                            <div class="rightGradient gradient"></div>
                            <div id="acyclicityFooter" class="scrollSync">
                                <ul id="acyclicityFooterList">

                                    <!-- Check iteration -->
                                    <li class="acyclicityIterationFooter" data-iteration="-1">
                                        <div class="shortcutNext" data-iteration="-1"></div>
                                        <div class="text-center p-2 d-flex">
                                            <p>Iteration stable?</p>
                                            <div class="stableYes form-check form-check-inline" data-iteration="-1">
                                                <input class="form-check-input" type="radio" name="stable_-1" id="stableYes_-1" value="yes" autocomplete="off">
                                                <label class="form-check-label" for="stableYes_-1">yes</label>
                                            </div>
                                            <div class="stableNo form-check form-check-inline" data-iteration="-1">
                                                <input class="form-check-input" type="radio" name="stable_-1" id="stableNo_-1" value="no" autocomplete="off">
                                                <label class="form-check-label" for="stableNo_-1">no</label>
                                            </div>
                                            <button type="button" id="iterationCheck_-1" class="btn btn-primary ms-5 flex-grow-1">Check</button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Strong acyclicity question -->
                        <div id="strongAcyclicityQuestion" class="card mt-5">
                            <div class="card-body d-flex">
                                <div class="flex-grow-1">
                                    <div><p id="strongAcyclicityQuestionText" class="d-inline-block"></p></div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="acyclic" id="acyclicYes" value="yes" autocomplete="off">
                                        <label class="form-check-label" for="acyclicYes">yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="acyclic" id="acyclicNo" value="no" autocomplete="off">
                                        <label class="form-check-label" for="acyclicNo">no</label>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <button type="button" id="acyclicityCheckButton" class="btn btn-primary py-2 px-4">Check</button>
                                </div>
                            </div>
                        </div>

                        <!-- Congrats -->
                        <div id="congrats" class="display-1 mt-5 mb-3 text-center"></div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="border-top text-center">
            <a href="https://www.in.tum.de/i02/impressum/" target="_blank" rel="noopener noreferrer" class="text-muted">Impressum</a>
        </div>
    </footer>
</div>

<!-- Help -->
<div class="modal fade" id="help" tabindex="-1" aria-labelledby="helpLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpLabel">Help</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>Del</kbd><br>
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- About -->
<div class="modal fade" id="about" tabindex="-1" aria-labelledby="aboutLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aboutLabel">About</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- SVGs -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
    </symbol>
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </symbol>
    <symbol id="info-circle" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
    </symbol>
    <symbol id="info-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
    </symbol>
    <symbol id="question-circle" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
    </symbol>
    <symbol id="arrows-to-center" fill="currentColor" viewBox="0 0 16 16">
        <path d="m13.188 14.118-1.8789-1.8821v2.5869h-1.2956l-0.0068-0.84422c-0.0037-0.46433-0.0068-1.5494-0.0068-2.4114l-5.7e-5 -1.5671h4.8248v1.3116h-2.5722l3.7474 3.7539-0.93307 0.93451z" stroke-width=".54876" style="paint-order:stroke fill markers"/>
        <path d="m2.8118 1.8821 1.8789 1.8821v-2.5869h1.2956l0.00686 0.84422c0.003784 0.46433 0.006868 1.5494 0.006868 2.4114l-1.7e-6 1.5671h-4.8247v-1.3116h2.5722l-3.7474-3.7539 0.93307-0.93451z" stroke-width=".54876" style="paint-order:stroke fill markers"/>
        <path d="m1.8821 13.188 1.8821-1.8788h-2.5869v-1.2956l0.84422-0.0069c0.46433-0.0038 1.5494-0.0069 2.4114-0.0069l1.5671 8.3e-5v4.8247h-1.3116v-2.5721l-3.7539 3.7474-0.93451-0.93306z" stroke-width=".54876" style="paint-order:stroke fill markers"/>
        <path d="m14.118 2.8118-1.8821 1.8789h2.5869v1.2956l-0.84422 0.00686c-0.46433 0.00378-1.5494 0.00686-2.4114 0.00686l-1.5671 6.3e-6v-4.8247h1.3116v2.5722l3.7539-3.7474 0.93451 0.93307z" stroke-width=".54876" style="paint-order:stroke fill markers"/>
    </symbol>
</svg>


<script src="bootstrap/bootstrap.5.1.3.bundle.min.js"></script>
<script src="jointJS/dependencies/jquery.3.6.0.js"></script>
<script src="jointJS/dependencies/lodash.4.17.21.js"></script>
<script src="jointJS/dependencies/backbone.1.4.0.js"></script>
<script src="jointJS/joint.3.5.4.min.js"></script>
<script src="codemirror/codemirror.5.65.2.js"></script>
<script type="module" src="js/init.js"></script>
</body>
</html>